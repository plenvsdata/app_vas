(function($,window,document,undefined){"use strict";var defaults={selected:0,keyNavigation:true,autoAdjustHeight:true,cycleSteps:false,backButtonSupport:true,useURLhash:true,showStepURLhash:true,lang:{next:"Next",previous:"Previous"},toolbarSettings:{toolbarPosition:"bottom",toolbarButtonPosition:"end",showNextButton:true,showPreviousButton:true,toolbarExtraButtons:[]},anchorSettings:{anchorClickable:true,enableAllAnchors:false,markDoneStep:true,markAllPreviousStepsAsDone:true,removeDoneStepOnNavigateBack:false,enableAnchorOnDoneStep:true},contentURL:null,contentCache:true,ajaxSettings:{},disabledSteps:[],errorSteps:[],hiddenSteps:[],theme:"default",transitionEffect:"none",transitionSpeed:"400"};function SmartWizard(element,options){this.options=$.extend(true,{},defaults,options);this.main=$(element);this.nav=this.main.children("ul");this.steps=$("li > a",this.nav);this.container=this.main.children("div");this.pages=this.container.children("div");this.current_index=null;this.options.toolbarSettings.toolbarButtonPosition=this.options.toolbarSettings.toolbarButtonPosition==="right"?"end":this.options.toolbarSettings.toolbarButtonPosition;this.options.toolbarSettings.toolbarButtonPosition=this.options.toolbarSettings.toolbarButtonPosition==="left"?"start":this.options.toolbarSettings.toolbarButtonPosition;this.options.theme=this.options.theme===null||this.options.theme===""?"default":this.options.theme;this.init()}$.extend(SmartWizard.prototype,{init:function(){this._setElements();this._setToolbar();this._setEvents();var idx=this.options.selected;if(this.options.useURLhash){var hash=window.location.hash;if(hash&&hash.length>0){var elm=$("a[href*='"+hash+"']",this.nav);if(elm.length>0){var id=this.steps.index(elm);idx=id>=0?id:idx}}}if(idx>0&&this.options.anchorSettings.markDoneStep&&this.options.anchorSettings.markAllPreviousStepsAsDone){this.steps.eq(idx).parent("li").prevAll().addClass("done")}this._showStep(idx)},_setElements:function(){this.main.addClass("sw-main sw-theme-"+this.options.theme);this.nav.addClass("nav nav-tabs step-anchor").children("li").addClass("nav-item").children("a").addClass("nav-link");if(this.options.anchorSettings.enableAllAnchors!==false&&this.options.anchorSettings.anchorClickable!==false){this.steps.parent("li").addClass("clickable")}this.container.addClass("sw-container tab-content");this.pages.addClass("tab-pane step-content");var mi=this;if(this.options.disabledSteps&&this.options.disabledSteps.length>0){$.each(this.options.disabledSteps,function(i,n){mi.steps.eq(n).parent("li").addClass("disabled")})}if(this.options.errorSteps&&this.options.errorSteps.length>0){$.each(this.options.errorSteps,function(i,n){mi.steps.eq(n).parent("li").addClass("danger")})}if(this.options.hiddenSteps&&this.options.hiddenSteps.length>0){$.each(this.options.hiddenSteps,function(i,n){mi.steps.eq(n).parent("li").addClass("hidden")})}return true},_setToolbar:function(){if(this.options.toolbarSettings.toolbarPosition==="none"){return true}var btnNext=this.options.toolbarSettings.showNextButton!==false?$("<button></button>").text(this.options.lang.next).addClass("btn btn-secondary sw-btn-next").attr("type","button"):null;var btnPrevious=this.options.toolbarSettings.showPreviousButton!==false?$("<button></button>").text(this.options.lang.previous).addClass("btn btn-secondary sw-btn-prev").attr("type","button"):null;var btnGroup=$("<div></div>").addClass("btn-group mr-2 sw-btn-group").attr("role","group").append(btnPrevious,btnNext);var btnGroupExtra=null;if(this.options.toolbarSettings.toolbarExtraButtons&&this.options.toolbarSettings.toolbarExtraButtons.length>0){btnGroupExtra=$("<div></div>").addClass("btn-group mr-2 sw-btn-group-extra").attr("role","group");$.each(this.options.toolbarSettings.toolbarExtraButtons,function(i,n){btnGroupExtra.append(n.clone(true))})}var toolbarTop,toolbarBottom;switch(this.options.toolbarSettings.toolbarPosition){case"top":toolbarTop=$("<div></div>").addClass("btn-toolbar sw-toolbar sw-toolbar-top justify-content-"+this.options.toolbarSettings.toolbarButtonPosition);toolbarTop.append(btnGroup);if(this.options.toolbarSettings.toolbarButtonPosition==="start"){toolbarTop.prepend(btnGroupExtra)}else{toolbarTop.append(btnGroupExtra)}this.container.before(toolbarTop);break;case"bottom":toolbarBottom=$("<div></div>").addClass("btn-toolbar sw-toolbar sw-toolbar-bottom justify-content-"+this.options.toolbarSettings.toolbarButtonPosition);toolbarBottom.append(btnGroup);if(this.options.toolbarSettings.toolbarButtonPosition==="start"){toolbarBottom.prepend(btnGroupExtra)}else{toolbarBottom.append(btnGroupExtra)}this.container.after(toolbarBottom);break;case"both":toolbarTop=$("<div></div>").addClass("btn-toolbar sw-toolbar sw-toolbar-top justify-content-"+this.options.toolbarSettings.toolbarButtonPosition);toolbarTop.append(btnGroup);if(this.options.toolbarSettings.toolbarButtonPosition==="start"){toolbarTop.prepend(btnGroupExtra)}else{toolbarTop.append(btnGroupExtra)}this.container.before(toolbarTop);toolbarBottom=$("<div></div>").addClass("btn-toolbar sw-toolbar sw-toolbar-bottom justify-content-"+this.options.toolbarSettings.toolbarButtonPosition);toolbarBottom.append(btnGroup.clone(true));if(btnGroupExtra!==null){if(this.options.toolbarSettings.toolbarButtonPosition==="start"){toolbarBottom.prepend(btnGroupExtra.clone(true))}else{toolbarBottom.append(btnGroupExtra.clone(true))}}this.container.after(toolbarBottom);break;default:toolbarBottom=$("<div></div>").addClass("btn-toolbar sw-toolbar sw-toolbar-bottom justify-content-"+this.options.toolbarSettings.toolbarButtonPosition);toolbarBottom.append(btnGroup);if(this.options.toolbarSettings.toolbarButtonPosition==="start"){toolbarBottom.append(btnGroupExtra)}else{toolbarBottom.append(btnGroupExtra)}this.container.after(toolbarBottom);break}return true},_setEvents:function(){var mi=this;$(this.steps).on("click",function(e){e.preventDefault();if(mi.options.anchorSettings.anchorClickable===false){return true}var idx=mi.steps.index(this);if(mi.options.anchorSettings.enableAnchorOnDoneStep===false&&mi.steps.eq(idx).parent("li").hasClass("done")){return true}if(idx!==mi.current_index){if(mi.options.anchorSettings.enableAllAnchors!==false&&mi.options.anchorSettings.anchorClickable!==false){mi._showStep(idx)}else{if(mi.steps.eq(idx).parent("li").hasClass("done")){mi._showStep(idx)}}}});$(".sw-btn-next",this.main).on("click",function(e){e.preventDefault();mi._showNext()});$(".sw-btn-prev",this.main).on("click",function(e){e.preventDefault();mi._showPrevious()});if(this.options.keyNavigation){$(document).keyup(function(e){mi._keyNav(e)})}if(this.options.backButtonSupport){$(window).on("hashchange",function(e){if(!mi.options.useURLhash){return true}if(window.location.hash){var elm=$("a[href*='"+window.location.hash+"']",mi.nav);if(elm&&elm.length>0){e.preventDefault();mi._showStep(mi.steps.index(elm))}}})}return true},_showNext:function(){var si=this.current_index+1;for(var i=si;i<this.steps.length;i++){if(!this.steps.eq(i).parent("li").hasClass("disabled")&&!this.steps.eq(i).parent("li").hasClass("hidden")){si=i;break}}if(this.steps.length<=si){if(!this.options.cycleSteps){return false}si=0}this._showStep(si);return true},_showPrevious:function(){var si=this.current_index-1;for(var i=si;i>=0;i--){if(!this.steps.eq(i).parent("li").hasClass("disabled")&&!this.steps.eq(i).parent("li").hasClass("hidden")){si=i;break}}if(0>si){if(!this.options.cycleSteps){return false}si=this.steps.length-1}this._showStep(si);return true},_showStep:function(idx){if(!this.steps.eq(idx)){return false}if(idx==this.current_index){return false}if(this.steps.eq(idx).parent("li").hasClass("disabled")||this.steps.eq(idx).parent("li").hasClass("hidden")){return false}this._loadStepContent(idx);return true},_loadStepContent:function(idx){var mi=this;var curTab=this.steps.eq(this.current_index);var stepDirection="";var elm=this.steps.eq(idx);var contentURL=elm.data("content-url")&&elm.data("content-url").length>0?elm.data("content-url"):this.options.contentURL;if(this.current_index!==null&&this.current_index!==idx){stepDirection=this.current_index<idx?"forward":"backward"}if(this.current_index!==null&&this._triggerEvent("leaveStep",[curTab,this.current_index,stepDirection])===false){return false}if(contentURL&&contentURL.length>0&&(!elm.data("has-content")||!this.options.contentCache)){var selPage=elm.length>0?$(elm.attr("href"),this.main):null;var ajaxSettings=$.extend(true,{},{url:contentURL,type:"POST",data:{step_number:idx},dataType:"text",beforeSend:function(){mi._loader("show")},error:function(jqXHR,status,message){mi._loader("hide");$.error(message)},success:function(res){if(res&&res.length>0){elm.data("has-content",true);selPage.html(res)}mi._loader("hide");mi._transitPage(idx)}},this.options.ajaxSettings);$.ajax(ajaxSettings)}else{this._transitPage(idx)}return true},_transitPage:function(idx){var mi=this;var curTab=this.steps.eq(this.current_index);var curPage=curTab.length>0?$(curTab.attr("href"),this.main):null;var selTab=this.steps.eq(idx);var selPage=selTab.length>0?$(selTab.attr("href"),this.main):null;var stepDirection="";if(this.current_index!==null&&this.current_index!==idx){stepDirection=this.current_index<idx?"forward":"backward"}var stepPosition="middle";if(idx===0){stepPosition="first"}else if(idx===this.steps.length-1){stepPosition="final"}this.options.transitionEffect=this.options.transitionEffect.toLowerCase();this.pages.finish();if(this.options.transitionEffect==="slide"){if(curPage&&curPage.length>0){curPage.slideUp("fast",this.options.transitionEasing,function(){selPage.slideDown(mi.options.transitionSpeed,mi.options.transitionEasing)})}else{selPage.slideDown(this.options.transitionSpeed,this.options.transitionEasing)}}else if(this.options.transitionEffect==="fade"){if(curPage&&curPage.length>0){curPage.fadeOut("fast",this.options.transitionEasing,function(){selPage.fadeIn("fast",mi.options.transitionEasing,function(){$(this).show()})})}else{selPage.fadeIn(this.options.transitionSpeed,this.options.transitionEasing,function(){$(this).show()})}}else{if(curPage&&curPage.length>0){curPage.hide()}selPage.show()}this._setURLHash(selTab.attr("href"));this._setAnchor(idx);this._setButtons(idx);this._fixHeight(idx);this.current_index=idx;this._triggerEvent("showStep",[selTab,this.current_index,stepDirection,stepPosition]);return true},_setAnchor:function(idx){this.steps.eq(this.current_index).parent("li").removeClass("active");if(this.options.anchorSettings.markDoneStep!==false&&this.current_index!==null){this.steps.eq(this.current_index).parent("li").addClass("done");if(this.options.anchorSettings.removeDoneStepOnNavigateBack!==false){this.steps.eq(idx).parent("li").nextAll().removeClass("done")}}this.steps.eq(idx).parent("li").removeClass("done").addClass("active");return true},_setButtons:function(idx){if(!this.options.cycleSteps){if(0>=idx){$(".sw-btn-prev",this.main).addClass("disabled")}else{$(".sw-btn-prev",this.main).removeClass("disabled")}if(this.steps.length-1<=idx){$(".sw-btn-next",this.main).addClass("disabled")}else{$(".sw-btn-next",this.main).removeClass("disabled")}}return true},_keyNav:function(e){var mi=this;switch(e.which){case 37:mi._showPrevious();e.preventDefault();break;case 39:mi._showNext();e.preventDefault();break;default:return}},_fixHeight:function(idx){if(this.options.autoAdjustHeight){var selPage=this.steps.eq(idx).length>0?$(this.steps.eq(idx).attr("href"),this.main):null;this.container.finish().animate({minHeight:selPage.outerHeight()},this.options.transitionSpeed,function(){})}return true},_triggerEvent:function(name,params){var e=$.Event(name);this.main.trigger(e,params);if(e.isDefaultPrevented()){return false}return e.result},_setURLHash:function(hash){if(this.options.showStepURLhash&&window.location.hash!==hash){window.location.hash=hash}},_loader:function(action){switch(action){case"show":this.main.addClass("sw-loading");break;case"hide":this.main.removeClass("sw-loading");break;default:this.main.toggleClass("sw-loading")}},theme:function(v){if(this.options.theme===v){return false}this.main.removeClass("sw-theme-"+this.options.theme);this.options.theme=v;this.main.addClass("sw-theme-"+this.options.theme);this._triggerEvent("themeChanged",[this.options.theme])},next:function(){this._showNext()},prev:function(){this._showPrevious()},reset:function(){if(this._triggerEvent("beginReset")===false){return false}this.container.stop(true);this.pages.stop(true);this.pages.hide();this.current_index=null;this._setURLHash(this.steps.eq(this.options.selected).attr("href"));$(".sw-toolbar",this.main).remove();this.steps.removeClass();this.steps.parents("li").removeClass();this.steps.data("has-content",false);this.init();this._triggerEvent("endReset")},stepState:function(stepArray,state){var mi=this;stepArray=$.isArray(stepArray)?stepArray:[stepArray];var selSteps=$.grep(this.steps,function(n,i){return $.inArray(i,stepArray)!==-1});if(selSteps&&selSteps.length>0){switch(state){case"disable":$(selSteps).parents("li").addClass("disabled");break;case"enable":$(selSteps).parents("li").removeClass("disabled");break;case"hide":$(selSteps).parents("li").addClass("hidden");break;case"show":$(selSteps).parents("li").removeClass("hidden");break;case"error-on":$(selSteps).parents("li").addClass("danger");break;case"error-off":$(selSteps).parents("li").removeClass("danger");break}}}});$.fn.smartWizard=function(options){var args=arguments;var instance;if(options===undefined||typeof options==="object"){return this.each(function(){if(!$.data(this,"smartWizard")){$.data(this,"smartWizard",new SmartWizard(this,options))}})}else if(typeof options==="string"&&options[0]!=="_"&&options!=="init"){instance=$.data(this[0],"smartWizard");if(options==="destroy"){$.data(this,"smartWizard",null)}if(instance instanceof SmartWizard&&typeof instance[options]==="function"){return instance[options].apply(instance,Array.prototype.slice.call(args,1))}else{return this}}}})(jQuery,window,document);