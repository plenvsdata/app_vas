(function($){var BECAME_VISIBLE_MESSAGE="becameVisible";var BECAME_UNVISIBLE_MESSAGE="becameUnvisible";var unvisibleSet=[];function isVisible(element){return $(element).is(":visible")}function inUnvisibleSet(element){return unvisibleSet.indexOf(element)!==-1}function isElement(element){return element.nodeType===1}function addToUnvisibleSet(element){if(!inUnvisibleSet(element)&&isElement(element)){unvisibleSet.push(element)}}function removeFromUnvisibleSet(element){var idx=unvisibleSet.indexOf(element);if(idx!=-1){unvisibleSet.splice(idx,1)}}function initUnvisibleSet(element){element.childNodes.forEach(function(child){if(!isVisible(child)){sendMessage(child,BECAME_UNVISIBLE_MESSAGE);addToUnvisibleSet(child)}else{sendMessage(child,BECAME_VISIBLE_MESSAGE);initUnvisibleSet(child)}})}function sendMessage(element,msg){$(element).trigger(msg)}function sendTreeMessage(element,msg){sendMessage(element,msg);element.childNodes.forEach(function(child){sendTreeMessage(child,msg)})}function becameVisible(element){removeFromUnvisibleSet(element);sendTreeMessage(element,BECAME_VISIBLE_MESSAGE)}function becameUnvisible(element){addToUnvisibleSet(element);sendTreeMessage(element,BECAME_UNVISIBLE_MESSAGE)}function bindVisibleUnvisible(){var target=document.getElementsByTagName("body")[0];var MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;var observer=new MutationObserver(function(mutations){mutations.map(function(mutation){return mutation.target}).forEach(function(element){if(inUnvisibleSet(element)){if(isVisible(element)){becameVisible(element)}}else{if(!isVisible(element)){becameUnvisible(element)}}})});var config={childList:false,attributes:true,characterData:false,subtree:true,attributeOldValue:false,characterDataOldValue:false,attributeFilter:["class","style"]};observer.observe(target,config)}document.addEventListener("DOMContentLoaded",function(){initUnvisibleSet(document.getElementsByTagName("body")[0]);bindVisibleUnvisible()})})(jQuery);